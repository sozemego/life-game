DROP TABLE IF EXISTS WORLD CASCADE;

CREATE TABLE WORLD (
  id INT GENERATED ALWAYS AS IDENTITY UNIQUE NOT NULL,
  user_id INT NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  tiles JSONB NOT NULL DEFAULT '[]',
  deleted BOOLEAN NOT NULL DEFAULT FALSE,
  deleted_at TIMESTAMP
);

/**
  Null world for entity templates.
 */
INSERT INTO WORLD (id, user_id, deleted)
 OVERRIDING SYSTEM VALUE
 VALUES
(
 -1, -1, false
);

DROP TABLE IF EXISTS ENTITY CASCADE;

CREATE TABLE ENTITY (
  id INT GENERATED ALWAYS AS IDENTITY UNIQUE NOT NULL,
  name VARCHAR(32) NOT NULL,
  world_id INT NOT NULL REFERENCES WORLD(id),
  physics JSONB,
  graphics JSONB
);